var Timer OverProduction_Timer = null
var Timer UnderProduction_Timer = null
var Number 

rule "Total Power Consumption"
when
  Item inverter1PowerDrawn received update
then
  val Number TotalPower = (inverter1ActivePower.state as DecimalType
    + inverter2PreBatDischarge.state as DecimalType
    + inverter1PowerDrawn.state as DecimalType
    - inverter2PreBatCharge.state as DecimalType
    - inverter1PowerGridFeedIn.state as DecimalType)
  if ( TotalPower >= 0 ) {
    TotalPowerConsumption.postUpdate(TotalPower)
  }

  val Number PowerBatIncl = (inverter1ActivePower.state as DecimalType
    + inverter2PreBatDischarge.state as DecimalType
    + inverter1PowerDrawn.state as DecimalType
    - inverter1PowerGridFeedIn.state as DecimalType)
  if ( TotalPower >= 0 ) {
    PowerConsumptionBatIncl.postUpdate(PowerBatIncl)
  }
end
